{
  "analysis_date": "2025-11-28T11:09:41.526484",
  "analysis_time_seconds": 1809.4805853366852,
  "analysis_time_formatted": "30.2 minutes",
  "llm_provider": "openai",
  "analysis_mode": "hybrid",
  "rag_enabled": false,
  "statistics": {
    "total_flows_analyzed": 14,
    "flows_with_vulnerabilities": 8,
    "total_vulnerability_lines": 12,
    "total_structural_risk_lines": 13,
    "total_detections_before_consolidation": 32,
    "total_lines_after_consolidation": 25,
    "consolidation_rate": "21.9%",
    "severity_distribution": {
      "critical": 2,
      "high": 9,
      "medium": 1,
      "low": 0
    },
    "cwe_distribution": {
      "CWE-787": 2,
      "CWE-312": 1,
      "CWE-120": 2,
      "CWE-120: Buffer Copy without Checking Size of Input": 6,
      "CWE-119": 1
    },
    "rule_distribution": {
      "other": 12,
      "shared_memory_overwrite": 2,
      "weak_input_validation": 5,
      "unencrypted_output": 1
    },
    "execution_time_seconds": 1809.4805853366852,
    "llm_calls": 50,
    "cache_hits": 13,
    "cache_partial_hits": 13,
    "cache_misses": 1,
    "cache_hit_rate": "92.9%",
    "token_usage": {},
    "retries": 15,
    "retry_successes": 14
  },
  "total_vulnerability_lines": 12,
  "vulnerabilities": [
    {
      "vulnerability_id": "VULN-0001",
      "file": "path/to/ta_code.c",
      "line": 155,
      "consolidated": true,
      "detection_count": 1,
      "severity": "critical",
      "confidence_level": "high",
      "primary_vulnerability_type": "CWE-787",
      "functions": [
        "some_ta_helper_function"
      ],
      "sink_functions": [
        "snprintf"
      ],
      "vulnerability_types": [
        "CWE-787"
      ],
      "rule_ids": [
        "shared_memory_overwrite"
      ],
      "descriptions": [
        "REE-tainted size used for `snprintf` into shared memory without bounds validation."
      ],
      "chains": [
        [
          "TA_InvokeCommandEntryPoint",
          "output",
          "produce_3",
          "snprintf"
        ]
      ],
      "taint_flow_summaries": [
        {
          "source": "The size argument for `snprintf` (e.g., `param[1].memref.size`) is directly taken from an untrusted Normal World source.",
          "propagation_path": [
            "`param[1].memref.size` (REE-tainted) used as size argument to `snprintf` @ path/to/ta_code.c:155"
          ],
          "sink": "The `snprintf` function writes into `param[1].memref.buffer` (REE-visible) using the untrusted size, potentially exceeding its allocated bounds."
        }
      ],
      "exploitation_analyses": [
        {
          "preconditions": [
            "An attacker can invoke the TA command that calls `snprintf` on line 155.",
            "The attacker can control `param[1].memref.size` and `param[1].memref.buffer`."
          ],
          "attack_scenario": "An attacker provides a `param[1].memref.size` value larger than the actual allocated size of `param[1].memref.buffer`. The `snprintf` call then writes past the end of the buffer, corrupting adjacent memory in the shared region.",
          "impact": "Memory corruption in shared memory, potentially leading to denial of service, privilege escalation, or information disclosure by corrupting other shared data structures."
        }
      ],
      "missing_mitigations": [
        {
          "type": "bounds_check",
          "location": "some_ta_helper_function:155",
          "recommendation": "Validate the REE-provided `param[1].memref.size` against the actual allocated size of `param[1].memref.buffer` before passing it to `snprintf`."
        }
      ],
      "decision_rationales": [
        "The `snprintf` call on line 155 uses a Normal World-provided size for a write into a shared memory buffer. Without proper validation of this size against the actual buffer allocation, an attacker can cause an out-of-bounds write, leading to shared memory corruption."
      ],
      "severity_distribution": {
        "critical": 1
      },
      "rule_distribution": {
        "shared_memory_overwrite": 1
      }
    },
    {
      "vulnerability_id": "VULN-0002",
      "file": "unknown",
      "line": 126,
      "consolidated": true,
      "detection_count": 1,
      "severity": "medium",
      "confidence_level": "high",
      "primary_vulnerability_type": "CWE-312",
      "functions": [
        "TA_InvokeCommandEntryPoint"
      ],
      "sink_functions": [
        "snprintf"
      ],
      "vulnerability_types": [
        "CWE-312"
      ],
      "rule_ids": [
        "unencrypted_output"
      ],
      "descriptions": [
        "Sensitive 'key_id' (labeled 'key') is written in plaintext to 'key_info_buffer', which is a REE-visible memory region, without any encryption."
      ],
      "chains": [
        [
          "TA_InvokeCommandEntryPoint",
          "output",
          "produce",
          "produce_2",
          "snprintf"
        ]
      ],
      "taint_flow_summaries": [
        {
          "source": "Sensitive 'key_id' (TEE-private)",
          "propagation_path": [
            "key_id -> snprintf argument @ unknown:126"
          ],
          "sink": "'key_info_buffer' (REE-visible memory)"
        }
      ],
      "exploitation_analyses": [
        {
          "preconditions": [
            "The Trusted Application is invoked with a REE-visible buffer for key information."
          ],
          "attack_scenario": "A malicious Normal World application can call the TA to request key information, and the TA will return the sensitive 'key_id' in plaintext within the provided REE-visible buffer.",
          "impact": "Disclosure of sensitive key identifiers, which could aid in enumeration of keys, targeted attacks, or provide insights into the TA's internal key management."
        }
      ],
      "missing_mitigations": [
        {
          "type": "encryption",
          "location": "TA_InvokeCommandEntryPoint:126",
          "recommendation": "Encrypt sensitive data like 'key_id' before writing it to REE-visible memory, or avoid exposing it to REE entirely."
        }
      ],
      "decision_rationales": [
        "The direct copy of a sensitive key identifier ('key_id') in plaintext to a Normal World-accessible buffer ('key_info_buffer') constitutes an unencrypted output vulnerability (CWE-312)."
      ],
      "severity_distribution": {
        "medium": 1
      },
      "rule_distribution": {
        "unencrypted_output": 1
      }
    },
    {
      "vulnerability_id": "VULN-0003",
      "file": "unknown",
      "line": 136,
      "consolidated": true,
      "detection_count": 1,
      "severity": "high",
      "confidence_level": "high",
      "primary_vulnerability_type": "CWE-120",
      "functions": [
        "unknown"
      ],
      "sink_functions": [
        "TEE_MemMove"
      ],
      "vulnerability_types": [
        "CWE-120"
      ],
      "rule_ids": [
        "weak_input_validation"
      ],
      "descriptions": [
        "The REE-tainted `param[0].memref.size` is used as the copy length without sufficient validation against the source buffer's actual size or the destination shared memory's allocated size, risking a buffer overflow or over-read."
      ],
      "chains": [
        [
          "TA_InvokeCommandEntryPoint",
          "output",
          "produce",
          "TEE_MemMove"
        ]
      ],
      "taint_flow_summaries": [
        {
          "source": "The `param[0].memref.size` value originates from the Normal World (REE) and is untrusted.",
          "propagation_path": [
            "`param[0].memref.size` (REE-tainted) -> `len` argument of `TEE_MemMove` @ unknown:136"
          ],
          "sink": "The `TEE_MemMove` function attempts to copy data using the untrusted length into REE-visible memory."
        }
      ],
      "exploitation_analyses": [
        {
          "preconditions": [
            "An attacker controls the `param[0].memref.size` value provided to the Trusted Application."
          ],
          "attack_scenario": "An attacker can provide an excessively large `param[0].memref.size` value, causing `TEE_MemMove` to write beyond the bounds of `param[0].memref.buffer` or read beyond `sensitive_key_buffer`, potentially corrupting adjacent memory or crashing the TA.",
          "impact": "Memory corruption, denial of service, or potential information disclosure if adjacent memory contains sensitive data."
        }
      ],
      "missing_mitigations": [
        {
          "type": "bounds_check",
          "location": "function:line|unknown",
          "recommendation": "Validate `param[0].memref.size` against both the actual size of `sensitive_key_buffer` and the allocated size of `param[0].memref.buffer` before calling `TEE_MemMove`."
        }
      ],
      "decision_rationales": [
        "The `TEE_MemMove` operation at line 136 uses a length parameter (`param[0].memref.size`) directly from the untrusted Normal World without proper validation against the sizes of the source or destination buffers, leading to a potential memory safety violation."
      ],
      "severity_distribution": {
        "high": 1
      },
      "rule_distribution": {
        "weak_input_validation": 1
      }
    },
    {
      "vulnerability_id": "VULN-0004",
      "file": "unknown",
      "line": 137,
      "consolidated": true,
      "detection_count": 1,
      "severity": "high",
      "confidence_level": "medium",
      "primary_vulnerability_type": "CWE-120: Buffer Copy without Checking Size of Input",
      "functions": [
        "TA_InvokeCommandEntryPoint"
      ],
      "sink_functions": [
        "snprintf"
      ],
      "vulnerability_types": [
        "CWE-120: Buffer Copy without Checking Size of Input"
      ],
      "rule_ids": [
        "weak_input_validation"
      ],
      "descriptions": [
        "The snprintf destination buffer is REE-visible, and its size argument is assumed to be derived from an untrusted REE source without sufficient validation, leading to a potential buffer overflow."
      ],
      "chains": [
        [
          "TA_InvokeCommandEntryPoint",
          "output",
          "produce",
          "snprintf"
        ]
      ],
      "taint_flow_summaries": [
        {
          "source": "TEE_Param field (e.g., param[0].memref.size) originating from Normal World (REE).",
          "propagation_path": [
            "TEE_Param.memref.size -> snprintf size argument @ unknown_file:line"
          ],
          "sink": "snprintf writes to a REE-visible buffer (e.g., param[0].memref.buffer)."
        }
      ],
      "exploitation_analyses": [
        {
          "preconditions": [
            "Malicious Normal World application provides an oversized length argument to the TA.",
            "TA processes the input without proper bounds checking."
          ],
          "attack_scenario": "A malicious REE application can provide a large size value to snprintf, causing it to write beyond the intended bounds of a shared memory buffer, potentially corrupting adjacent REE-visible data or causing a denial of service.",
          "impact": "Data corruption in shared memory, denial of service, potential information disclosure if adjacent memory contains sensitive data."
        }
      ],
      "missing_mitigations": [
        {
          "type": "bounds_check",
          "location": "TA_InvokeCommandEntryPoint:137 (and others)",
          "recommendation": "Validate the size argument against the actual allocated buffer size before passing it to snprintf, ensuring it does not exceed the buffer's capacity."
        }
      ],
      "decision_rationales": [
        "The snprintf function is called with a destination buffer that is assumed to be REE-visible and a size argument that is assumed to be derived from an untrusted REE source without adequate validation. This creates a classic buffer overflow vulnerability where a malicious REE can cause the TA to overwrite shared memory, leading to data corruption or denial of service. This aligns with the shared_memory_overwrite rule, triggered by weak_input_validation."
      ],
      "severity_distribution": {
        "high": 1
      },
      "rule_distribution": {
        "weak_input_validation": 1
      }
    },
    {
      "vulnerability_id": "VULN-0005",
      "file": "unknown",
      "line": 143,
      "consolidated": true,
      "detection_count": 1,
      "severity": "high",
      "confidence_level": "medium",
      "primary_vulnerability_type": "CWE-120: Buffer Copy without Checking Size of Input",
      "functions": [
        "TA_InvokeCommandEntryPoint"
      ],
      "sink_functions": [
        "snprintf"
      ],
      "vulnerability_types": [
        "CWE-120: Buffer Copy without Checking Size of Input"
      ],
      "rule_ids": [
        "weak_input_validation"
      ],
      "descriptions": [
        "The snprintf destination buffer is REE-visible, and its size argument is assumed to be derived from an untrusted REE source without sufficient validation, leading to a potential buffer overflow."
      ],
      "chains": [
        [
          "TA_InvokeCommandEntryPoint",
          "output",
          "produce",
          "snprintf"
        ]
      ],
      "taint_flow_summaries": [
        {
          "source": "TEE_Param field (e.g., param[0].memref.size) originating from Normal World (REE).",
          "propagation_path": [
            "TEE_Param.memref.size -> snprintf size argument @ unknown_file:line"
          ],
          "sink": "snprintf writes to a REE-visible buffer (e.g., param[0].memref.buffer)."
        }
      ],
      "exploitation_analyses": [
        {
          "preconditions": [
            "Malicious Normal World application provides an oversized length argument to the TA.",
            "TA processes the input without proper bounds checking."
          ],
          "attack_scenario": "A malicious REE application can provide a large size value to snprintf, causing it to write beyond the intended bounds of a shared memory buffer, potentially corrupting adjacent REE-visible data or causing a denial of service.",
          "impact": "Data corruption in shared memory, denial of service, potential information disclosure if adjacent memory contains sensitive data."
        }
      ],
      "missing_mitigations": [
        {
          "type": "bounds_check",
          "location": "TA_InvokeCommandEntryPoint:137 (and others)",
          "recommendation": "Validate the size argument against the actual allocated buffer size before passing it to snprintf, ensuring it does not exceed the buffer's capacity."
        }
      ],
      "decision_rationales": [
        "The snprintf function is called with a destination buffer that is assumed to be REE-visible and a size argument that is assumed to be derived from an untrusted REE source without adequate validation. This creates a classic buffer overflow vulnerability where a malicious REE can cause the TA to overwrite shared memory, leading to data corruption or denial of service. This aligns with the shared_memory_overwrite rule, triggered by weak_input_validation."
      ],
      "severity_distribution": {
        "high": 1
      },
      "rule_distribution": {
        "weak_input_validation": 1
      }
    },
    {
      "vulnerability_id": "VULN-0006",
      "file": "unknown",
      "line": 144,
      "consolidated": true,
      "detection_count": 1,
      "severity": "high",
      "confidence_level": "medium",
      "primary_vulnerability_type": "CWE-120: Buffer Copy without Checking Size of Input",
      "functions": [
        "TA_InvokeCommandEntryPoint"
      ],
      "sink_functions": [
        "snprintf"
      ],
      "vulnerability_types": [
        "CWE-120: Buffer Copy without Checking Size of Input"
      ],
      "rule_ids": [
        "weak_input_validation"
      ],
      "descriptions": [
        "The snprintf destination buffer is REE-visible, and its size argument is assumed to be derived from an untrusted REE source without sufficient validation, leading to a potential buffer overflow."
      ],
      "chains": [
        [
          "TA_InvokeCommandEntryPoint",
          "output",
          "produce",
          "snprintf"
        ]
      ],
      "taint_flow_summaries": [
        {
          "source": "TEE_Param field (e.g., param[0].memref.size) originating from Normal World (REE).",
          "propagation_path": [
            "TEE_Param.memref.size -> snprintf size argument @ unknown_file:line"
          ],
          "sink": "snprintf writes to a REE-visible buffer (e.g., param[0].memref.buffer)."
        }
      ],
      "exploitation_analyses": [
        {
          "preconditions": [
            "Malicious Normal World application provides an oversized length argument to the TA.",
            "TA processes the input without proper bounds checking."
          ],
          "attack_scenario": "A malicious REE application can provide a large size value to snprintf, causing it to write beyond the intended bounds of a shared memory buffer, potentially corrupting adjacent REE-visible data or causing a denial of service.",
          "impact": "Data corruption in shared memory, denial of service, potential information disclosure if adjacent memory contains sensitive data."
        }
      ],
      "missing_mitigations": [
        {
          "type": "bounds_check",
          "location": "TA_InvokeCommandEntryPoint:137 (and others)",
          "recommendation": "Validate the size argument against the actual allocated buffer size before passing it to snprintf, ensuring it does not exceed the buffer's capacity."
        }
      ],
      "decision_rationales": [
        "The snprintf function is called with a destination buffer that is assumed to be REE-visible and a size argument that is assumed to be derived from an untrusted REE source without adequate validation. This creates a classic buffer overflow vulnerability where a malicious REE can cause the TA to overwrite shared memory, leading to data corruption or denial of service. This aligns with the shared_memory_overwrite rule, triggered by weak_input_validation."
      ],
      "severity_distribution": {
        "high": 1
      },
      "rule_distribution": {
        "weak_input_validation": 1
      }
    },
    {
      "vulnerability_id": "VULN-0007",
      "file": "unknown",
      "line": 147,
      "consolidated": true,
      "detection_count": 1,
      "severity": "high",
      "confidence_level": "medium",
      "primary_vulnerability_type": "CWE-120: Buffer Copy without Checking Size of Input",
      "functions": [
        "TA_InvokeCommandEntryPoint"
      ],
      "sink_functions": [
        "snprintf"
      ],
      "vulnerability_types": [
        "CWE-120: Buffer Copy without Checking Size of Input"
      ],
      "rule_ids": [
        "weak_input_validation"
      ],
      "descriptions": [
        "The snprintf destination buffer is REE-visible, and its size argument is assumed to be derived from an untrusted REE source without sufficient validation, leading to a potential buffer overflow."
      ],
      "chains": [
        [
          "TA_InvokeCommandEntryPoint",
          "output",
          "produce",
          "snprintf"
        ]
      ],
      "taint_flow_summaries": [
        {
          "source": "TEE_Param field (e.g., param[0].memref.size) originating from Normal World (REE).",
          "propagation_path": [
            "TEE_Param.memref.size -> snprintf size argument @ unknown_file:line"
          ],
          "sink": "snprintf writes to a REE-visible buffer (e.g., param[0].memref.buffer)."
        }
      ],
      "exploitation_analyses": [
        {
          "preconditions": [
            "Malicious Normal World application provides an oversized length argument to the TA.",
            "TA processes the input without proper bounds checking."
          ],
          "attack_scenario": "A malicious REE application can provide a large size value to snprintf, causing it to write beyond the intended bounds of a shared memory buffer, potentially corrupting adjacent REE-visible data or causing a denial of service.",
          "impact": "Data corruption in shared memory, denial of service, potential information disclosure if adjacent memory contains sensitive data."
        }
      ],
      "missing_mitigations": [
        {
          "type": "bounds_check",
          "location": "TA_InvokeCommandEntryPoint:137 (and others)",
          "recommendation": "Validate the size argument against the actual allocated buffer size before passing it to snprintf, ensuring it does not exceed the buffer's capacity."
        }
      ],
      "decision_rationales": [
        "The snprintf function is called with a destination buffer that is assumed to be REE-visible and a size argument that is assumed to be derived from an untrusted REE source without adequate validation. This creates a classic buffer overflow vulnerability where a malicious REE can cause the TA to overwrite shared memory, leading to data corruption or denial of service. This aligns with the shared_memory_overwrite rule, triggered by weak_input_validation."
      ],
      "severity_distribution": {
        "high": 1
      },
      "rule_distribution": {
        "weak_input_validation": 1
      }
    },
    {
      "vulnerability_id": "VULN-0008",
      "file": "unknown",
      "line": 148,
      "consolidated": true,
      "detection_count": 1,
      "severity": "high",
      "confidence_level": "medium",
      "primary_vulnerability_type": "CWE-120: Buffer Copy without Checking Size of Input",
      "functions": [
        "TA_InvokeCommandEntryPoint"
      ],
      "sink_functions": [
        "snprintf"
      ],
      "vulnerability_types": [
        "CWE-120: Buffer Copy without Checking Size of Input"
      ],
      "rule_ids": [
        "weak_input_validation"
      ],
      "descriptions": [
        "The snprintf destination buffer is REE-visible, and its size argument is assumed to be derived from an untrusted REE source without sufficient validation, leading to a potential buffer overflow."
      ],
      "chains": [
        [
          "TA_InvokeCommandEntryPoint",
          "output",
          "produce",
          "snprintf"
        ]
      ],
      "taint_flow_summaries": [
        {
          "source": "TEE_Param field (e.g., param[0].memref.size) originating from Normal World (REE).",
          "propagation_path": [
            "TEE_Param.memref.size -> snprintf size argument @ unknown_file:line"
          ],
          "sink": "snprintf writes to a REE-visible buffer (e.g., param[0].memref.buffer)."
        }
      ],
      "exploitation_analyses": [
        {
          "preconditions": [
            "Malicious Normal World application provides an oversized length argument to the TA.",
            "TA processes the input without proper bounds checking."
          ],
          "attack_scenario": "A malicious REE application can provide a large size value to snprintf, causing it to write beyond the intended bounds of a shared memory buffer, potentially corrupting adjacent REE-visible data or causing a denial of service.",
          "impact": "Data corruption in shared memory, denial of service, potential information disclosure if adjacent memory contains sensitive data."
        }
      ],
      "missing_mitigations": [
        {
          "type": "bounds_check",
          "location": "TA_InvokeCommandEntryPoint:137 (and others)",
          "recommendation": "Validate the size argument against the actual allocated buffer size before passing it to snprintf, ensuring it does not exceed the buffer's capacity."
        }
      ],
      "decision_rationales": [
        "The snprintf function is called with a destination buffer that is assumed to be REE-visible and a size argument that is assumed to be derived from an untrusted REE source without adequate validation. This creates a classic buffer overflow vulnerability where a malicious REE can cause the TA to overwrite shared memory, leading to data corruption or denial of service. This aligns with the shared_memory_overwrite rule, triggered by weak_input_validation."
      ],
      "severity_distribution": {
        "high": 1
      },
      "rule_distribution": {
        "weak_input_validation": 1
      }
    },
    {
      "vulnerability_id": "VULN-0009",
      "file": "unknown",
      "line": 154,
      "consolidated": true,
      "detection_count": 1,
      "severity": "high",
      "confidence_level": "high",
      "primary_vulnerability_type": "CWE-120: Buffer Copy without Checking Size of Input",
      "functions": [
        "unknown"
      ],
      "sink_functions": [
        "TEE_MemMove"
      ],
      "vulnerability_types": [
        "CWE-120: Buffer Copy without Checking Size of Input"
      ],
      "rule_ids": [
        "weak_input_validation"
      ],
      "descriptions": [
        "The copy length, originating from the Normal World, is used without validation to write into a Normal World-visible buffer, leading to a potential buffer overflow."
      ],
      "chains": [
        [
          "TA_InvokeCommandEntryPoint",
          "output",
          "produce_3",
          "TEE_MemMove"
        ]
      ],
      "taint_flow_summaries": [
        {
          "source": "Copy length (e.g., TEE_Param[1].memref.size) originates from the Normal World (REE) and is untrusted.",
          "propagation_path": [
            "REE-controlled size -> TEE_MemMove @ unknown_file:154"
          ],
          "sink": "TEE_MemMove writes to a Normal World-visible buffer (e.g., TEE_Param[0].memref.buffer) using the untrusted length."
        }
      ],
      "exploitation_analyses": [
        {
          "preconditions": [
            "Attacker controls the size parameter passed to the TA.",
            "The destination buffer is accessible by the REE."
          ],
          "attack_scenario": "A malicious Normal World application can provide an excessively large size, causing TEE_MemMove to write beyond the intended bounds of the REE-visible destination buffer, potentially corrupting adjacent data or leading to denial of service.",
          "impact": "Data corruption, denial of service, potential privilege escalation if critical data structures are overwritten in shared memory."
        }
      ],
      "missing_mitigations": [
        {
          "type": "bounds_check",
          "location": "unknown:154",
          "recommendation": "Validate the provided copy length against the actual allocated size of the destination buffer and the source buffer before calling TEE_MemMove."
        }
      ],
      "decision_rationales": [
        "The TEE_MemMove operation at line 154 uses a copy length directly derived from an untrusted Normal World input (e.g., TEE_Param[1].memref.size) to write into a Normal World-visible memory buffer (e.g., TEE_Param[0].memref.buffer). Without proper bounds validation, this allows the Normal World to control the write length, leading to an out-of-bounds write and corruption of shared memory, which is a shared_memory_overwrite vulnerability."
      ],
      "severity_distribution": {
        "high": 1
      },
      "rule_distribution": {
        "weak_input_validation": 1
      }
    },
    {
      "vulnerability_id": "VULN-0010",
      "file": "unknown",
      "line": 175,
      "consolidated": true,
      "detection_count": 1,
      "severity": "critical",
      "confidence_level": "high",
      "primary_vulnerability_type": "CWE-119",
      "functions": [
        "invokeCommand"
      ],
      "sink_functions": [
        "TEE_MemMove"
      ],
      "vulnerability_types": [
        "CWE-119"
      ],
      "rule_ids": [
        "shared_memory_overwrite"
      ],
      "descriptions": [
        "The copy length derived from untrusted input is not validated against the destination buffer size, allowing an attacker to overwrite shared memory."
      ],
      "chains": [
        [
          "TA_InvokeCommandEntryPoint",
          "output",
          "TEE_MemMove"
        ]
      ],
      "taint_flow_summaries": [
        {
          "source": "REE-provided copy length (e.g., from TEE_Param.value.a) and destination buffer size (e.g., from TEE_Param.memref.size).",
          "propagation_path": [
            "REE-tainted length -> copy_len @ unknown:175",
            "REE-visible buffer -> dst @ unknown:175"
          ],
          "sink": "TEE_MemMove writing to REE-visible memory."
        }
      ],
      "exploitation_analyses": [
        {
          "preconditions": [
            "Attacker controls the copy length and destination buffer size via TEE_Param.",
            "No effective bounds check on the copy length against the destination buffer's actual size."
          ],
          "attack_scenario": "An attacker provides a copy length larger than the allocated destination buffer in shared memory, causing TEE_MemMove to write beyond its bounds. This can corrupt adjacent data, lead to denial of service, or potentially arbitrary code execution in the Normal World.",
          "impact": "Memory corruption, denial of service, potential arbitrary code execution, or information disclosure."
        }
      ],
      "missing_mitigations": [
        {
          "type": "bounds_check",
          "location": "invokeCommand:175",
          "recommendation": "Validate the copy length against both the source and destination buffer sizes before calling TEE_MemMove, ensuring it does not exceed the minimum of the two."
        }
      ],
      "decision_rationales": [
        "The TEE_MemMove operation at line 175 uses a copy length derived from untrusted REE input. The destination buffer is also REE-visible shared memory. Without proper validation of the copy length against the actual size of the destination buffer, an attacker can provide an oversized length, leading to a buffer overflow and `shared_memory_overwrite` in the Normal World's memory space."
      ],
      "severity_distribution": {
        "critical": 1
      },
      "rule_distribution": {
        "shared_memory_overwrite": 1
      }
    },
    {
      "vulnerability_id": "VULN-0011",
      "file": "unknown",
      "line": 350,
      "consolidated": true,
      "detection_count": 1,
      "severity": "high",
      "confidence_level": "high",
      "primary_vulnerability_type": "CWE-787",
      "functions": [
        "unknown"
      ],
      "sink_functions": [
        "TEE_MemMove"
      ],
      "vulnerability_types": [
        "CWE-787"
      ],
      "rule_ids": [
        "shared_memory_overwrite"
      ],
      "descriptions": [
        "REE-tainted length from TEE_Param used for TEE_MemMove into REE-visible memory without bounds check."
      ],
      "chains": [
        [
          "TA_InvokeCommandEntryPoint",
          "shared_memory",
          "produce_s",
          "TEE_MemMove"
        ]
      ],
      "taint_flow_summaries": [
        {
          "source": "REE-originated TEE_Param.memref.size",
          "propagation_path": [
            "TEE_Param.memref.size -> copy_len @ unknown:350"
          ],
          "sink": "TEE_MemMove writing to TEE_Param.memref.buffer"
        }
      ],
      "exploitation_analyses": [
        {
          "preconditions": [
            "Attacker controls TEE_Param.memref.size and TEE_Param.memref.buffer."
          ],
          "attack_scenario": "Malicious Normal World provides an oversized TEE_Param.memref.size, causing TEE_MemMove to write beyond the allocated bounds of the shared buffer, corrupting adjacent memory.",
          "impact": "Data corruption, denial of service, potential privilege escalation within shared memory regions."
        }
      ],
      "missing_mitigations": [
        {
          "type": "bounds_check",
          "location": "unknown:350",
          "recommendation": "Validate TEE_Param.memref.size against the actual allocated size of TEE_Param.memref.buffer (e.g., TEE_Param.memref.shm_size) before calling TEE_MemMove."
        }
      ],
      "decision_rationales": [
        "The TEE_MemMove operation uses a length value directly from an untrusted Normal World parameter (TEE_Param.memref.size) to write into a shared memory buffer (TEE_Param.memref.buffer). Without proper validation of this length against the buffer's actual size, an attacker can cause an out-of-bounds write, leading to a shared memory overwrite."
      ],
      "severity_distribution": {
        "high": 1
      },
      "rule_distribution": {
        "shared_memory_overwrite": 1
      }
    },
    {
      "vulnerability_id": "VULN-0012",
      "file": "unknown",
      "line": 401,
      "consolidated": true,
      "detection_count": 1,
      "severity": "high",
      "confidence_level": "medium",
      "primary_vulnerability_type": "CWE-120",
      "functions": [
        "unknown"
      ],
      "sink_functions": [
        "TEE_MemMove"
      ],
      "vulnerability_types": [
        "CWE-120"
      ],
      "rule_ids": [
        "shared_memory_overwrite"
      ],
      "descriptions": [
        "The copy length is assumed untrusted and not validated against buffer bounds, leading to a potential overwrite of shared memory."
      ],
      "chains": [
        [
          "TA_InvokeCommandEntryPoint",
          "shared_memory",
          "produce_s3",
          "TEE_MemMove"
        ]
      ],
      "taint_flow_summaries": [
        {
          "source": "Copy length (assumed REE-tainted) originating from an unspecified TEE_Param field.",
          "propagation_path": [
            "Unknown propagation path from REE input to copy length at line 401."
          ],
          "sink": "TEE_MemMove writes to a REE-visible buffer at line 401, using the untrusted copy length."
        }
      ],
      "exploitation_analyses": [
        {
          "preconditions": [
            "TA is invoked with a malicious copy length derived from a TEE_Param.",
            "The destination buffer for TEE_MemMove is REE-visible shared memory."
          ],
          "attack_scenario": "A malicious Normal World application provides an overly large length to TEE_MemMove, causing it to write beyond the intended bounds of a shared memory buffer, potentially corrupting other shared data or leading to denial of service.",
          "impact": "Data corruption, denial of service, potential information disclosure or privilege escalation if corrupted data affects sensitive structures or control flow."
        }
      ],
      "missing_mitigations": [
        {
          "type": "bounds_check",
          "location": "unknown:401",
          "recommendation": "Implement robust validation of the copy length against the actual sizes of both the source and destination buffers before calling TEE_MemMove, especially when the length originates from an untrusted source."
        }
      ],
      "decision_rationales": [
        "Based on the common vulnerability pattern for TEE_MemMove, an untrusted copy length originating from the Normal World, combined with an assumed lack of effective bounds checking, can lead to an overwrite of a REE-visible shared memory buffer. This directly satisfies the criteria for a 'shared_memory_overwrite' vulnerability, with memory safety taking precedence."
      ],
      "severity_distribution": {
        "high": 1
      },
      "rule_distribution": {
        "shared_memory_overwrite": 1
      }
    }
  ],
  "total_finding_lines": 13,
  "structural_risks": [
    {
      "finding_id": "RISK-0001",
      "file": "/workspace/benchmark/bad-partitioning/ta/entry.c",
      "line": 136,
      "consolidated": true,
      "detection_count": 1,
      "primary_rule": "other",
      "functions": [
        "TEE_MemMove"
      ],
      "sink_functions": [
        "=",
        "TEE_MemMove"
      ],
      "rules": [
        "other"
      ],
      "phases": [
        "unknown"
      ],
      "descriptions": [
        "Binding of callee parameter 'dst' to REE-visible buffer 'params[1].memref.buffer'",
        "Binding of callee parameter 'src' to TEE-private buffer 'key1'",
        "Copying TA-private sensitive data to REE-visible memory without explicit encryption."
      ],
      "code_excerpts": [
        "TEE_MemMove(params[1].memref.buffer, key1, strlen(key1));"
      ],
      "rule_matches": {
        "rule_id": [
          "other"
        ],
        "others": [
          "flow_dir:TA->REE",
          "src_region:TEE-private",
          "dst_region:REE-visible",
          "sensitivity_label:key",
          "size_triplet:copy_len=strlen(key1),src_sz=1000,dst_sz=params[1].memref.size"
        ]
      },
      "rule_distribution": {
        "other": 1
      },
      "phase_distribution": {
        "unknown": 1
      }
    },
    {
      "finding_id": "RISK-0002",
      "file": "/workspace/benchmark/bad-partitioning/ta/entry.c",
      "line": 137,
      "consolidated": true,
      "detection_count": 3,
      "primary_rule": "other",
      "functions": [
        "snprintf"
      ],
      "sink_functions": [
        "=",
        "snprintf"
      ],
      "rules": [
        "other",
        "shared_memory_overwrite",
        "weak_input_validation"
      ],
      "phases": [
        "unknown"
      ],
      "descriptions": [
        "Callee parameter 's' (buffer) aliases a REE-visible buffer.",
        "Callee parameter 'n' (size) aliases a REE-tainted value.",
        "Callee parameter 'format' aliases a TEE-private constant string.",
        "Callee parameter (source data) aliases a TEE-private variable.",
        "`snprintf` writes into a REE-visible buffer using a REE-tainted size without validation.",
        "The size argument to `snprintf` is REE-tainted and used without prior validation."
      ],
      "code_excerpts": [
        "snprintf(params[2].memref.buffer, params[2].memref.size, \"%s\", key1);"
      ],
      "rule_matches": {
        "rule_id": [
          "other",
          "shared_memory_overwrite",
          "weak_input_validation"
        ],
        "others": [
          "flow_dir:unknown",
          "src_region:unknown",
          "dst_region:REE-visible",
          "sensitivity_label:unknown",
          "size_triplet:copy_len=?,src_sz=?,dst_sz=?",
          "dst_region:unknown",
          "src_region:TEE-private",
          "sensitivity_label:public",
          "flow_dir:TA->REE",
          "size_triplet:copy_len=?,src_sz=?,dst_sz=params[2].memref.size",
          "flow_dir:REE->TA",
          "src_region:REE-visible",
          "size_triplet:copy_len=?,src_sz=params[2].memref.size,dst_sz=?"
        ]
      },
      "rule_distribution": {
        "weak_input_validation": 1,
        "other": 1,
        "shared_memory_overwrite": 1
      },
      "phase_distribution": {
        "unknown": 1
      }
    },
    {
      "finding_id": "RISK-0003",
      "file": "/workspace/benchmark/bad-partitioning/ta/entry.c",
      "line": 154,
      "consolidated": true,
      "detection_count": 2,
      "primary_rule": "weak_input_validation",
      "functions": [
        "produce_3",
        "TEE_MemMove"
      ],
      "sink_functions": [
        "TEE_MemMove",
        "="
      ],
      "rules": [
        "weak_input_validation",
        "other"
      ],
      "phases": [
        "unknown"
      ],
      "descriptions": [
        "Fixed-size write to REE-visible buffer without validating against provided buffer size.",
        "Binding of callee parameter 'dst' to caller argument 'buf' (origin unknown)",
        "Binding of callee parameter 'src' to caller argument 'key' (TEE-private buffer)",
        "Data copied from TEE-private public buffer to buffer of unknown region and sensitivity"
      ],
      "code_excerpts": [
        "TEE_MemMove(buf, key, strlen(key));"
      ],
      "rule_matches": {
        "rule_id": [
          "weak_input_validation",
          "other"
        ],
        "others": [
          "flow_dir:TA->REE",
          "src_region:TEE-private",
          "dst_region:REE-visible",
          "sensitivity_label:public",
          "size_triplet:copy_len=strlen(key),src_sz=strlen(key),dst_sz=size",
          "flow_dir:unknown",
          "src_region:unknown",
          "dst_region:unknown",
          "sensitivity_label:unknown",
          "size_triplet:copy_len=unknown,src_sz=unknown,dst_sz=unknown",
          "dst_region:TEE-private",
          "size_triplet:copy_len=unknown,src_sz=1000,dst_sz=unknown",
          "flow_dir:TA->unknown",
          "size_triplet:copy_len=strlen(key),src_sz=1000,dst_sz=unknown"
        ]
      },
      "rule_distribution": {
        "weak_input_validation": 1,
        "other": 1
      },
      "phase_distribution": {
        "unknown": 1
      }
    },
    {
      "finding_id": "RISK-0004",
      "file": "/workspace/benchmark/bad-partitioning/ta/entry.c",
      "line": 155,
      "consolidated": true,
      "detection_count": 1,
      "primary_rule": "shared_memory_overwrite",
      "functions": [
        "produce_3"
      ],
      "sink_functions": [
        "snprintf"
      ],
      "rules": [
        "shared_memory_overwrite"
      ],
      "phases": [
        "unknown"
      ],
      "descriptions": [
        "REE-tainted size used as buffer limit for snprintf into REE-visible memory without validation."
      ],
      "code_excerpts": [
        "snprintf(buf, size, \"%s\", key);"
      ],
      "rule_matches": {
        "rule_id": [
          "shared_memory_overwrite"
        ],
        "others": [
          "flow_dir:TA->REE",
          "src_region:TEE-private",
          "dst_region:REE-visible",
          "sensitivity_label:public",
          "size_triplet:copy_len=strlen(key),src_sz=strlen(key),dst_sz=size"
        ]
      },
      "rule_distribution": {
        "shared_memory_overwrite": 1
      },
      "phase_distribution": {
        "unknown": 1
      }
    },
    {
      "finding_id": "RISK-0005",
      "file": "/workspace/benchmark/bad-partitioning/ta/entry.c",
      "line": 175,
      "consolidated": true,
      "detection_count": 2,
      "primary_rule": "other",
      "functions": [
        "TEE_MemMove"
      ],
      "sink_functions": [
        "=",
        "TEE_MemMove"
      ],
      "rules": [
        "other",
        "unencrypted_output"
      ],
      "phases": [
        "unknown"
      ],
      "descriptions": [
        "Alias of REE-visible buffer passed as destination.",
        "Alias of TEE-private buffer passed as source.",
        "Sensitive data from TEE-private 'key' is copied to REE-visible memory without encryption."
      ],
      "code_excerpts": [
        "TEE_MemMove(params[1].memref.buffer, key, strlen(key));"
      ],
      "rule_matches": {
        "rule_id": [
          "other",
          "unencrypted_output"
        ],
        "others": [
          "flow_dir:TA->REE",
          "src_region:TEE-private",
          "dst_region:REE-visible",
          "sensitivity_label:public",
          "size_triplet:copy_len=strlen(key),src_sz=1000,dst_sz=params[1].memref.size",
          "sensitivity_label:key"
        ]
      },
      "rule_distribution": {
        "other": 1,
        "unencrypted_output": 1
      },
      "phase_distribution": {
        "unknown": 1
      }
    },
    {
      "finding_id": "RISK-0006",
      "file": "/workspace/benchmark/bad-partitioning/ta/entry.c",
      "line": 350,
      "consolidated": true,
      "detection_count": 2,
      "primary_rule": "weak_input_validation",
      "functions": [
        "produce_s",
        "TEE_MemMove"
      ],
      "sink_functions": [
        "TEE_MemMove",
        "="
      ],
      "rules": [
        "weak_input_validation",
        "other"
      ],
      "phases": [
        "unknown"
      ],
      "descriptions": [
        "tainted size used for TEE_MemMove into TEE-private buffer 'str' from REE-visible 'buf'",
        "Callee parameter 'dst' bound to TEE-private local buffer 'str'.",
        "Callee parameter 'src' bound to 'buf', which may originate from REE-visible memory.",
        "Callee parameter 'len' bound to 'size', which may be REE-tainted and controls copy length."
      ],
      "code_excerpts": [
        "TEE_MemMove(str, buf, size);"
      ],
      "rule_matches": {
        "rule_id": [
          "weak_input_validation",
          "other"
        ],
        "others": [
          "flow_dir:REE->TA",
          "src_region:REE-visible",
          "dst_region:TEE-private",
          "sensitivity_label:unknown",
          "size_triplet:copy_len=size,src_sz=unknown,dst_sz=1000",
          "flow_dir:unknown",
          "src_region:TEE-private",
          "sensitivity_label:public",
          "size_triplet:copy_len=unknown,src_sz=1000,dst_sz=unknown",
          "dst_region:REE-visible",
          "size_triplet:copy_len=unknown,src_sz=unknown,dst_sz=unknown",
          "dst_region:unknown"
        ]
      },
      "rule_distribution": {
        "weak_input_validation": 1,
        "other": 1
      },
      "phase_distribution": {
        "unknown": 1
      }
    },
    {
      "finding_id": "RISK-0007",
      "file": "/workspace/benchmark/bad-partitioning/ta/entry.c",
      "line": 401,
      "consolidated": true,
      "detection_count": 2,
      "primary_rule": "weak_input_validation",
      "functions": [
        "produce_s3",
        "TEE_MemMove"
      ],
      "sink_functions": [
        "TEE_MemMove",
        "="
      ],
      "rules": [
        "weak_input_validation",
        "other"
      ],
      "phases": [
        "unknown"
      ],
      "descriptions": [
        "untrusted REE-visible buffer copied into TEE-private buffer 'str'",
        "callee parameter 'dest' aliases TEE-private stack buffer 'str'",
        "callee parameter 'src' aliases REE-visible shared memory buffer",
        "callee parameter 'len' is an untrusted REE-originated size",
        "Untrusted REE data copied into TEE-private buffer; content not validated despite size check"
      ],
      "code_excerpts": [],
      "rule_matches": {
        "rule_id": [
          "weak_input_validation",
          "other"
        ],
        "others": [
          "flow_dir:REE->TA",
          "src_region:REE-visible",
          "dst_region:TEE-private",
          "sensitivity_label:unknown",
          "size_triplet:copy_len=params[0].memref.size,src_sz=?,dst_sz=1000",
          "flow_dir:unknown",
          "src_region:TEE-private",
          "size_triplet:copy_len=0,src_sz=1000,dst_sz=1000",
          "dst_region:REE-visible",
          "size_triplet:copy_len=0,src_sz=params[0].memref.size,dst_sz=params[0].memref.size",
          "sensitivity_label:public",
          "size_triplet:copy_len=params[0].memref.size,src_sz=sizeof(uint32_t),dst_sz=sizeof(uint32_t)",
          "size_triplet:copy_len=params[0].memref.size,src_sz=params[0].memref.size,dst_sz=1000"
        ]
      },
      "rule_distribution": {
        "weak_input_validation": 1,
        "other": 1
      },
      "phase_distribution": {
        "unknown": 1
      }
    },
    {
      "finding_id": "RISK-0008",
      "file": "/workspace/benchmark/bad-partitioning/ta/entry.c",
      "line": 485,
      "consolidated": true,
      "detection_count": 2,
      "primary_rule": "other",
      "functions": [
        "TEE_MemMove"
      ],
      "sink_functions": [
        "=",
        "TEE_MemMove"
      ],
      "rules": [
        "other",
        "weak_input_validation"
      ],
      "phases": [
        "unknown"
      ],
      "descriptions": [
        "callee parameter 'dest' aliases caller's TEE-private buffer 'str'",
        "callee parameter 'src' aliases caller's REE-visible (tainted) buffer 'params[0].memref.buffer'",
        "tainted size `params[0].memref.size` used to copy into fixed-size TEE-private buffer `str` (100 bytes) without effective bounds check"
      ],
      "code_excerpts": [],
      "rule_matches": {
        "rule_id": [
          "other",
          "weak_input_validation"
        ],
        "others": [
          "flow_dir:unknown",
          "src_region:unknown",
          "dst_region:TEE-private",
          "sensitivity_label:unknown",
          "size_triplet:copy_len=?,src_sz=?,dst_sz=?",
          "src_region:REE-visible",
          "dst_region:unknown",
          "flow_dir:REE->TA",
          "sensitivity_label:public",
          "size_triplet:copy_len=params[0].memref.size,src_sz=params[0].memref.size,dst_sz=100"
        ]
      },
      "rule_distribution": {
        "weak_input_validation": 1,
        "other": 1
      },
      "phase_distribution": {
        "unknown": 1
      }
    },
    {
      "finding_id": "RISK-0009",
      "file": "unknown",
      "line": 155,
      "consolidated": true,
      "detection_count": 1,
      "primary_rule": "other",
      "functions": [
        "unknown"
      ],
      "sink_functions": [
        "snprintf"
      ],
      "rules": [
        "other"
      ],
      "phases": [
        "unknown"
      ],
      "descriptions": [
        "Untrusted size parameter 'size' and REE-visible destination buffer 'buf' are used in snprintf without validation, potentially leading to a shared memory overwrite."
      ],
      "code_excerpts": [],
      "rule_matches": {
        "rule_id": [],
        "others": []
      },
      "rule_distribution": {
        "other": 1
      },
      "phase_distribution": {
        "unknown": 1
      }
    },
    {
      "finding_id": "RISK-0010",
      "file": "unknown",
      "line": 181,
      "consolidated": true,
      "detection_count": 1,
      "primary_rule": "other",
      "functions": [
        "unknown"
      ],
      "sink_functions": [
        "="
      ],
      "rules": [
        "other"
      ],
      "phases": [
        "unknown"
      ],
      "descriptions": [
        "Alias of REE-originated TEE_Param array passed into helper function."
      ],
      "code_excerpts": [],
      "rule_matches": {
        "rule_id": [],
        "others": []
      },
      "rule_distribution": {
        "other": 1
      },
      "phase_distribution": {
        "unknown": 1
      }
    },
    {
      "finding_id": "RISK-0011",
      "file": "unknown",
      "line": 227,
      "consolidated": true,
      "detection_count": 1,
      "primary_rule": "other",
      "functions": [
        "unknown"
      ],
      "sink_functions": [
        "=",
        "TEE_MemMove"
      ],
      "rules": [
        "other"
      ],
      "phases": [
        "unknown"
      ],
      "descriptions": [
        "Alias of caller-provided buffer `buf3` passed as source to `TEE_MemMove`.",
        "Alias of caller-provided buffer `str` passed as destination to `TEE_MemMove`.",
        "Potential buffer overflow if `size3` is untrusted and exceeds the size of `str` or `buf3`."
      ],
      "code_excerpts": [],
      "rule_matches": {
        "rule_id": [],
        "others": []
      },
      "rule_distribution": {
        "other": 1
      },
      "phase_distribution": {
        "unknown": 1
      }
    },
    {
      "finding_id": "RISK-0012",
      "file": "unknown",
      "line": 311,
      "consolidated": true,
      "detection_count": 1,
      "primary_rule": "other",
      "functions": [
        "unknown"
      ],
      "sink_functions": [
        "="
      ],
      "rules": [
        "other"
      ],
      "phases": [
        "unknown"
      ],
      "descriptions": [],
      "code_excerpts": [],
      "rule_matches": {
        "rule_id": [],
        "others": []
      },
      "rule_distribution": {
        "other": 1
      },
      "phase_distribution": {
        "unknown": 1
      }
    },
    {
      "finding_id": "RISK-0013",
      "file": "unknown",
      "line": 485,
      "consolidated": true,
      "detection_count": 1,
      "primary_rule": "other",
      "functions": [
        "unknown"
      ],
      "sink_functions": [
        "TEE_MemMove"
      ],
      "rules": [
        "other"
      ],
      "phases": [
        "unknown"
      ],
      "descriptions": [
        "Cannot determine taint flow, regions, or size validation without code context or prior analysis results for TEE_MemMove parameters."
      ],
      "code_excerpts": [],
      "rule_matches": {
        "rule_id": [
          "other"
        ],
        "others": [
          "flow_dir:unknown",
          "src_region:unknown",
          "dst_region:unknown",
          "sensitivity_label:unknown",
          "size_triplet:copy_len=?,src_sz=?,dst_sz=?"
        ]
      },
      "rule_distribution": {
        "other": 1
      },
      "phase_distribution": {
        "unknown": 1
      }
    }
  ]
}